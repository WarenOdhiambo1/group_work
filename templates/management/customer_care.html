{% extends 'base.html' %}

{% block content %}
<div class="container section">
    <div class="care-header">
        <h1>Customer Care Center</h1>
        <p>Handle customer needs efficiently based on inquiry type</p>
        <a href="/management/melissa/" class="btn btn-outline">‚Üê Back to Dashboard</a>
    </div>

    <div class="care-tabs">
        <button class="tab-btn active" onclick="showTab('new')">New Inquiries</button>
        <button class="tab-btn" onclick="showTab('booking')">Booking Issues</button>
        <button class="tab-btn" onclick="showTab('payment')">Payment Support</button>
        <button class="tab-btn" onclick="showTab('general')">General Support</button>
    </div>

    <!-- NEW INQUIRIES TAB -->
    <div id="new" class="tab-content active">
        <div class="care-grid">
            <div class="care-card urgent">
                <h3>Urgent Inquiries</h3>
                {% for inquiry in urgent_inquiries %}
                <div class="inquiry-item">
                    <div class="inquiry-header">
                        <strong>{{ inquiry.name }}</strong>
                        <span class="time">{{ inquiry.created_at|timesince }} ago</span>
                    </div>
                    <p class="subject">{{ inquiry.subject }}</p>
                    <div class="contact-info">
                        <span>{{ inquiry.email }}</span>
                        <span>{{ inquiry.phone }}</span>
                    </div>
                    <div class="actions">
                        <a href="/admin/operations/inquiry/{{ inquiry.id }}/change/" class="btn-sm btn-primary">Handle Inquiry</a>
                    </div>
                </div>
                {% empty %}
                <p>No urgent inquiries</p>
                {% endfor %}
            </div>

            <div class="care-card">
                <h3>Regular Inquiries</h3>
                {% for inquiry in regular_inquiries %}
                <div class="inquiry-item">
                    <div class="inquiry-header">
                        <strong>{{ inquiry.name }}</strong>
                        <span class="time">{{ inquiry.created_at|timesince }} ago</span>
                    </div>
                    <p class="subject">{{ inquiry.subject }}</p>
                    <div class="actions">
                        <a href="/admin/operations/inquiry/{{ inquiry.id }}/change/" class="btn-sm btn-primary">Handle Inquiry</a>
                    </div>
                </div>
                {% empty %}
                <p>No regular inquiries</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- BOOKING ISSUES TAB -->
    <div id="booking" class="tab-content">
        <div class="care-grid">
            <div class="care-card">
                <h3>Booking Modifications</h3>
                <div class="care-actions">
                    <a href="/admin/operations/booking/" class="action-btn">
                        <div>
                            <h4>Reschedule Booking</h4>
                            <p>Change date/time for existing booking</p>
                        </div>
                    </a>
                    <a href="/admin/operations/booking/" class="action-btn">
                        <div>
                            <h4>Cancel Booking</h4>
                            <p>Process cancellation and refund</p>
                        </div>
                    </a>
                    <a href="/admin/operations/booking/" class="action-btn">
                        <div>
                            <h4>Modify Details</h4>
                            <p>Update guest count, special requests</p>
                        </div>
                    </a>
                </div>
            </div>

            <div class="care-card">
                <h3>Booking Conflicts</h3>
                {% for booking in conflict_bookings %}
                <div class="conflict-item">
                    <strong>{{ booking.customer_name }}</strong> - {{ booking.activity.name }}
                    <span class="date">{{ booking.date }}</span>
                    <div class="conflict-actions">
                        <a href="/admin/operations/booking/{{ booking.id }}/change/" class="btn-sm btn-primary">Handle Booking</a>
                    </div>
                </div>
                {% empty %}
                <p>No booking conflicts</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- PAYMENT SUPPORT TAB -->
    <div id="payment" class="tab-content">
        <div class="care-grid">
            <div class="care-card">
                <h3>Payment Actions</h3>
                <div class="care-actions">
                    <form method="post" action="{% url 'update_payment_status' 0 %}" class="action-btn">
                        {% csrf_token %}
                        <div>
                            <h4>Process Payment</h4>
                            <p>Mark payment as received</p>
                        </div>
                    </form>
                    <a href="/admin/accounts/payment/" class="action-btn">
                        <div>
                            <h4>Issue Refund</h4>
                            <p>Process customer refund</p>
                        </div>
                    </a>
                    <a href="/admin/accounts/payment/" class="action-btn">
                        <div>
                            <h4>Handle Dispute</h4>
                            <p>Resolve payment disputes</p>
                        </div>
                    </a>
                </div>
            </div>

            <div class="care-card">
                <h3>Pending Payments</h3>
                {% for payment in pending_payments %}
                <div class="payment-item">
                    <div class="payment-info">
                        <strong>${{ payment.amount }}</strong> - {{ payment.booking.customer_name }}
                        <p>{{ payment.booking.activity.name }} on {{ payment.booking.date }}</p>
                    </div>
                    <div class="payment-actions">
                        <form method="post" action="{% url 'update_payment_status' payment.id %}" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="status" value="PAID">
                            <button type="submit" class="btn-sm btn-primary">Mark Paid</button>
                        </form>
                    </div>
                </div>
                {% empty %}
                <p>No pending payments</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- GENERAL SUPPORT TAB -->
    <div id="general" class="tab-content">
        <div class="care-grid">
            <div class="care-card">
                <h3>Quick Actions</h3>
                <div class="care-actions">
                    <a href="/admin/operations/booking/" class="action-btn">
                        <div>
                            <h4>Weather Update</h4>
                            <p>Send weather alerts to customers</p>
                        </div>
                    </a>
                    <a href="/admin/operations/booking/" class="action-btn">
                        <div>
                            <h4>Check Availability</h4>
                            <p>View real-time booking availability</p>
                        </div>
                    </a>
                    <a href="/admin/operations/activity/" class="action-btn">
                        <div>
                            <h4>Send Directions</h4>
                            <p>Share location and meeting points</p>
                        </div>
                    </a>
                </div>
            </div>

            <div class="care-card">
                <h3>Contact Templates</h3>
                <div class="template-list">
                    <div class="template-item">
                        <h4>Welcome Message</h4>
                        <p>Thank you for choosing Backyard Adventures...</p>
                    </div>
                    <div class="template-item">
                        <h4>Booking Confirmation</h4>
                        <p>Your booking has been confirmed for...</p>
                    </div>
                    <div class="template-item">
                        <h4>Appointment Reminder</h4>
                        <p>This is a friendly reminder about your...</p>
                    </div>
                    <div class="template-item">
                        <h4>Follow-up Message</h4>
                        <p>We hope you enjoyed your adventure...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> confirmed for...</p>
                    </div>
                    <div class="template-item" onclick="useTemplate('reminder')">
                        <h4>Appointment Reminder</h4>
                        <p>This is a friendly reminder about your...</p>
                    </div>
                    <div class="template-item" onclick="useTemplate('followup')">
                        <h4>Follow-up Message</h4>
                        <p>We hope you enjoyed your adventure...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.care-header { text-align: center; margin-bottom: 2rem; display: flex; flex-direction: column; align-items: center; gap: 1rem; }
.care-tabs { display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; }
.tab-btn { padding: 0.8rem 1.5rem; border: 2px solid var(--primary-green); background: white; color: var(--primary-green); border-radius: 25px; cursor: pointer; transition: all 0.3s; }
.tab-btn.active, .tab-btn:hover { background: var(--primary-green); color: white; }
.tab-content { display: none; }
.tab-content.active { display: block; }
.care-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; }
.care-card { background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 5px 20px var(--shadow); }
.care-card.urgent { border-left: 4px solid #ff4444; }
.care-card h3 { margin-bottom: 1rem; color: var(--text-dark); }
.inquiry-item, .conflict-item, .payment-item { padding: 1rem; border: 1px solid var(--accent-green); border-radius: 8px; margin-bottom: 1rem; }
.inquiry-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
.time { font-size: 0.8rem; color: var(--text-light); }
.subject { font-weight: 600; margin-bottom: 0.5rem; }
.contact-info { display: flex; gap: 1rem; font-size: 0.9rem; margin-bottom: 1rem; }
.actions, .conflict-actions, .payment-actions { display: flex; gap: 0.5rem; }
.btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; border-radius: 15px; border: 1px solid var(--primary-green); cursor: pointer; }
.btn-primary { background: var(--primary-green); color: white; }
.btn-outline { background: white; color: var(--primary-green); }
.care-actions { display: flex; flex-direction: column; gap: 1rem; }
.action-btn { display: flex; align-items: center; padding: 1rem; border: 1px solid var(--accent-green); border-radius: 10px; background: white; cursor: pointer; transition: all 0.3s; text-decoration: none; color: inherit; }
.action-btn:hover { background: var(--accent-green); }
.action-btn h4 { margin: 0; color: var(--text-dark); }
.action-btn p { margin: 0; color: var(--text-light); font-size: 0.9rem; }
.template-list { display: flex; flex-direction: column; gap: 0.5rem; }
.template-item { padding: 1rem; border: 1px solid var(--accent-green); border-radius: 8px; cursor: pointer; transition: all 0.3s; }
.template-item:hover { background: var(--accent-green); }
.template-item h4 { margin: 0 0 0.5rem 0; color: var(--text-dark); }
.template-item p { margin: 0; color: var(--text-light); font-size: 0.9rem; }
</style>

<script>
function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');
}

function handleInquiry(id, action) {
    alert(`Handling inquiry ${id} with action: ${action}`);
}

function handleBookingIssue(type) {
    alert(`Handling booking issue: ${type}`);
}

function handlePayment(action) {
    alert(`Processing payment action: ${action}`);
}

function quickAction(type) {
    alert(`Quick action: ${type}`);
}

function useTemplate(template) {
    alert(`Using template: ${template}`);
}

function markPaid(paymentId) {
    alert(`Marking payment ${paymentId} as paid`);
}
</script>
{% endblock %}