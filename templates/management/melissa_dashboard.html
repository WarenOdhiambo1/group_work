{% extends 'base.html' %}

{% block content %}
<div class="container section">
    <div class="dashboard-header">
        <h1>Customer Service Dashboard - Melissa</h1>
        <div class="dashboard-nav">
            <a href="/management/customer-care/" class="btn btn-primary">Customer Care</a>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="dashboard-card">
            <h3>Pending Inquiries ({{ pending_inquiries.count }})</h3>
            {% for inquiry in pending_inquiries %}
            <div class="inquiry-item">
                <div class="inquiry-info">
                    <strong>{{ inquiry.name }}</strong> - {{ inquiry.subject }}
                    <p>{{ inquiry.email }} | {{ inquiry.phone }}</p>
                    <small>{{ inquiry.created_at|date:"M d, Y" }}</small>
                </div>
                <div class="inquiry-actions">
                    <a href="/admin/operations/inquiry/{{ inquiry.id }}/change/" class="btn btn-sm btn-outline">Handle</a>
                </div>
            </div>
            {% empty %}
            <p>No pending inquiries</p>
            {% endfor %}
        </div>

        <div class="dashboard-card">
            <h3>Pending Payments ({{ pending_payments.count }})</h3>
            {% for payment in pending_payments %}
            <div class="payment-item">
                <div class="payment-info">
                    <strong>${{ payment.amount }}</strong> - {{ payment.booking.customer_name }}
                    <p>{{ payment.booking.activity.name }} on {{ payment.booking.date }}</p>
                </div>
                <form method="post" action="{% url 'update_payment_status' payment.id %}" style="display: inline;">
                    {% csrf_token %}
                    <select name="status" onchange="this.form.submit()">
                        <option value="PENDING">Pending</option>
                        <option value="PAID">Mark Paid</option>
                        <option value="FAILED">Failed</option>
                    </select>
                </form>
            </div>
            {% empty %}
            <p>No pending payments</p>
            {% endfor %}
        </div>

        <div class="dashboard-card">
            <h3>My Assigned Inquiries</h3>
            {% for inquiry in my_inquiries %}
            <div class="inquiry-item">
                <strong>{{ inquiry.name }}</strong> - {{ inquiry.subject }}
                <span class="status {{ inquiry.status|lower }}">{{ inquiry.status }}</span>
            </div>
            {% empty %}
            <p>No assigned inquiries</p>
            {% endfor %}
        </div>
    </div>
</div>

<style>
.dashboard-header { margin-bottom: 2rem; }
.dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; }
.dashboard-card { background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 3px 10px var(--shadow); }
.inquiry-item, .payment-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--accent-green); }
.inquiry-info, .payment-info { flex: 1; }
.inquiry-actions { display: flex; gap: 0.5rem; }
.btn-sm { padding: 0.3rem 0.8rem; font-size: 0.8rem; }
.status.new { color: red; }
.status.in_progress { color: orange; }
.status.resolved { color: green; }
select { padding: 0.3rem; border: 1px solid var(--accent-green); border-radius: 5px; }
</style>
{% endblock %}